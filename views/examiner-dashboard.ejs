<!DOCTYPE html>
<html lang="en">
  <%- include('layouts/head'); -%>
  <body>
    <%- include('layouts/header'); -%>

    <main>
      <h2>Examiner Dashboard</h2>
      <p>Filter by test type:</p>
      <form method="GET" action="/examiner-dashboard">
        <select name="testType" onchange="this.form.submit()">
          <option value="" <%= testType === '' ? 'selected' : '' %>>All</option>
          <option value="G2" <%= testType === 'G2' ? 'selected' : '' %>>G2</option>
          <option value="G"  <%= testType === 'G'  ? 'selected' : '' %>>G</option>
        </select>
      </form>
      
      <h3>List of Drivers Ready for Drive Test:</h3>
      <table>
        <thead>
          <tr>
            <th>Driver Name</th>
            <th>Car Make</th>
            <th>Car Model</th>
            <th>Car Year</th> 
            <th>Car Plate</th>
            <th>Appointment Date</th>
            <th>Appointment Time</th>
            <th>Test Type</th>
            <!-- NEW -->
            <th>Result</th>
            <th>Comment</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% if (appointments.length > 0) { %>
            <% appointments.forEach(appointment => { %>
              <tr>
                <td><%= appointment.driverName || 'Unknown' %></td>
                <td><%= appointment.carMake || 'N/A' %></td>
                <td><%= appointment.carModel || 'N/A' %></td>
                <td><%= appointment.carYear || 'N/A' %></td>
                <td><%= appointment.carPlate || 'N/A' %></td>
                <td><%= appointment.date || 'N/A' %></td>
                <td><%= appointment.time || 'N/A' %></td>
                <td><%= appointment.testType %></td>

                <!-- NEW: inputs belong to the form in the last cell -->
                <td>
                  <select name="passFail" form="f_<%= appointment.userId %>">
                    <option value="true"  <%= appointment.passFail === true  ? 'selected' : '' %>>Pass</option>
                    <option value="false" <%= appointment.passFail === false ? 'selected' : '' %>>Fail</option>
                  </select>
                </td>
                <td>
                  <input type="text"
                         name="comment"
                         form="f_<%= appointment.userId %>"
                         value="<%= appointment.comment || '' %>" />
                  <input type="hidden"
                         name="currentFilter"
                         form="f_<%= appointment.userId %>"
                         value="<%= testType %>" />
                </td>
                <td>
                  <form method="POST"
                        id="f_<%= appointment.userId %>"
                        action="/examiner/result/<%= appointment.userId %>">
                    <button type="submit">Save</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="11">No appointments found.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </main>

    <%- include('layouts/footer'); -%>
  </body>
</html>
